version: '2'
services:
  canal-server:
    image: canal/canal-server
    restart: always
    environment:
      - canal.instance.master.address=db:3306
      - canal.instance.dbUsername=db_user
      - canal.instance.dbPassword=Wzj_mysql01
    ports:
      - ""
    depends_on:
      - db

  db:
    image: 'mysql:5.7'
    command: mysqld --user=root --verbose --log-bin==mysql-bin --binlog-format=row --server-id=1
    restart: always
#    volumes:
#      - /opt/data/mysql/db:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=Wzj_mysql01
      - MYSQL_PASSWORD=Wzj_mysql01
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=db_user      
